[use]
plugin = basics
plugin = analytics
plugin = lodex

[env]
path = url
value = https://api.openalex.org/works

path = query
value = fix('institutions.country_code:fr,publication_year:2022')

path = currentDate
value = thru(() => new Date()).thru(d => d.toDateString().replace(/\s/g, '_')).thru(m => env('Startup') ? 'latest' : m)

[replace]
path = filter
value = env('query')

path = cursor
value = *

[URLRequest]
timeout = 60000
url = env('url')

[loop]
test = has('meta.next_cursor')

[loop/replace]
path = filter
value = env('query')

path = cursor
value = get('meta.next_cursor')

[loop/URLRequest]
url = env('url')
timeout = 60000

[loop/drop]
path = meta.next_cursor

[exploding]
value = results

[exchange]
value = get('value')

[objects2columns]

[CSVString]
strict = true
separator = fix('\t')

[FILESave]
location = fix(`${env('PWD')}/public/${env('FileName')}`)
identifier = fix(`${env('FileName')}-${env('currentDate')}.tsv`)
compress = true

[exchange]
value = get('filename').append(' generated.')

[dump]
indent = true
