[use]
plugin = basics
plugin = analytics

[env]
path = url
value = https://api.openalex.org/works

path = query
value = fix('institutions.country_code:fr,publication_year:2022')

path = currentDate
value = thru(() => new Date()).thru(d => d.getDay()).thru(i => ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'][i]).thru(m => env('Startup') ? 'Startup' : m)

[replace]
path = filter
value = env('query')

path = cursor
value = *

[URLRequest]
timeout = 60000
url = env('url')

[loop]
test = has('meta.next_cursor')

[loop/replace]
path = filter
value = env('query')

path = cursor
value = get('meta.next_cursor')

[loop/URLRequest]
url = env('url')
timeout = 60000

[loop/drop]
path = meta.next_cursor

[exploding]
value = results

[exchange]
value = get('value')

[dump]
indent = true

[FILESave]
location = fix(`${env('PWD')}/public/${env('FileName')}`)
identifier = fix(`${env('FileName')}-${env('currentDate')}.json`)
compress = true

[exchange]
value = get('filename').append(' generated.')

[dump]
indent = true
