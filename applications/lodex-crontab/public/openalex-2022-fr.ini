[use]
plugin = basics
plugin = istex

[env]
path = url
value = https://api.openalex.org/works

path = query
value = fix('institutions.country_code:fr,publication_year:2022')

path = currentMonth
value = thru(() => new Date()).thru(d => d.getMonth() + 1).thru(m => env('Startup') ? 'latest' : m)

[replace]
path = filter
value = env('query')

[URLRequest]
url = env('url')
timeout = 60000

[replace]
path = filter
value = env('query')

path = total
value = get('meta.count')

[URLPagination]
total = get('total')
maxPages = 10000

[replace]
path = filter
value = get('filter')

path = page
value = get('pageNumber')

[URLStream]
url = env('url')
path = results
timeout = 60000

[dump]
indent = true

[FILESave]
location = fix(`${env('PWD')}/public/${env('FileName')}`)
identifier = fix(`${env('FileName')}-${env('currentMonth')}.json`)
compress = true

[exchange]
value = get('filename').append(' generated.')

[dump]
indent = true
